# Docker Compose Configuration for Chh-OLA Big Data Project

services:
  spark-container:
    container_name: chh-ola-spark
    build:
      context: ..             # Build from current folder (where Dockerfile exists)
      dockerfile: docker/Dockerfile
    # Remove the 'image' tag or make it secondary (optional name)
    image: chh-ola-bigdata

    ports:
      - "8888:8888"    # Jupyter Notebook
      - "4040:4040"    # Spark UI
      - "18080:18080"  # Spark History Server

    volumes:
      - ../data:/app/data
      - ../scripts:/app/scripts
      - ../output:/app/output
      - ../notebooks:/app/notebooks

    environment:
      - SPARK_MASTER=local[*]
      - SPARK_DRIVER_MEMORY=2g
      - SPARK_EXECUTOR_MEMORY=2g
      - SPARK_WORKER_CORES=2
      - PYTHONPATH=/app

    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4G
        reservations:
          cpus: '2'
          memory: 2G

    stdin_open: true
    tty: true

    networks:
      - bigdata-network

networks:
  bigdata-network:
    driver: bridge
